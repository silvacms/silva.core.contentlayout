<tal:init define="baseurl content/absolute_url;
                  mode options/mode;
                  partconfig options/partconfig">
<div class="header-title">
 <div tal:condition="options/submitOnTop" class="float-right">
 <input class="button"
        type="submit"
        value="Save"
        tal:attributes="name options/submitButtonName"
        i18n:attributes="value;title"
    />
 </div>
 <tal:cond condition="python:hasattr(context.aq_explicit, 'get_icon') and context.get_icon()">
  <img tal:replace="structure python:context.get_icon().tag()" />
 </tal:cond>
 <tal:cond condition="python:not(hasattr(context.aq_explicit, 'get_icon') and context.get_icon())">
  <img tal:replace="structure python:context.render_icon(context)" />
 </tal:cond>
 <span tal:content="python:mode == 'add' and 'Add' or 'Edit'" />
 <span tal:content="context/title" />
</div>

<form name="edit-dialog-form" id="edit-dialog-form" method="post"
 tal:omit-tag="options/suppressFormTag"
 tal:attributes="action python:baseurl + (mode=='add' and '/@@tab_edit_cl_add_es_to_slot' or '/@@tab_edit_cl_save_part')"
 tal:define="fields python:context.get_parameters_form().get_fields()">
<!-- <div class="description" tal:condition="context/description"
    tal:content="context/description" />--><div class="description">DESCRIPTION</div>
 <input type="hidden" name="parttype" value="es" />
 <input type="hidden" name="slotname"
   tal:attributes="value options/slotname" />
 <input type="hidden" tal:condition="options/partkey"
   name="partkey"
   tal:attributes="value options/partkey"
   />
 <input type="hidden" name="esname" 
   tal:attributes="value context/id" />
 <div class="description" tal:condition="not:fields">
  There are no parameters to configure for this external source.
 </div>
 <table width="100%" class="listing" cellpadding="0" cellspacing="0"
   tal:condition="fields">
 <thead>
  <tr>
   <th>Element</th>
   <th>Value</th>
  </tr>
 </thead>
 <tbody>
  <tal:loop repeat="field fields">
   <tal:cond condition="not:field/hidden">
   <tr tal:define="iterate python:repeat['field'].odd() and 'odd' or 'even';
                   required python:field.values.get('required',False);
                   desc python:field.values.get('description','')"
     tal:attributes="class python:iterate + (required and ' required' or '')">
    <tal:cond condition="python:field.meta_type != 'TinyMCEField'">
     <td class="designator">
      <label tal:attributes="for field/generate_field_key"
        tal:content="structure field/title" />
      <span class="warning" 
        tal:condition="required">*</span>
      <p tal:condition="desc"
         tal:content="desc" />
     </td>
     <td tal:define="value python:partconfig and partconfig.get(field.id,None) or None">
      <input tal:condition="python:options['from_request']"
        tal:replace="structure python:field.render_from_request(request)" />
      <input tal:condition="python:not options['from_request']"
        tal:replace="structure python:field.render(value)" />
     </td>
    </tal:cond>
    <tal:cond condition="python:field.meta_type == 'TinyMCEField'">
     <td colspan="2"
       tal:define="value python:partconfig and partconfig.get(field.id,None) or None">
      <div class="designator">
       <label tal:attributes="for field/generate_field_key"
         tal:content="structure field/title" />
       <span class="warning" 
         tal:condition="required">*</span>
       <p tal:condition="desc"
          tal:content="desc"
          style="text-align:left;" />
      </div>
      <input tal:condition="python:options['from_request']"
        tal:replace="structure python:field.render_from_request(request)" />
      <input tal:condition="python:not options['from_request']"
        tal:replace="structure python:field.render(value)" />
     </td>
    </tal:cond>
   </tr>
   </tal:cond>
  </tal:loop>
 </tbody>
  <tfoot tal:condition="python:options['submitButtonName']">
  <tr class="controls">
   <td>&nbsp;</td>
   <td>
    <input class="button"
           type="submit"
           value="Save"
           tal:attributes="name options/submitButtonName"
           i18n:attributes="value;title"
       />
   </td>
  </tr>
 </tfoot>
 </table>
  <tal:loop repeat="field fields">
   <tal:cond condition="field/hidden">
    <input tal:define="value python:partconfig and partconfig.get(field.id,None) or None"
           tal:replace="structure python:field.render(value)" />
   </tal:cond>
  </tal:loop>
 </form>
</tal:init>