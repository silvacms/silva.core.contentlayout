<metal:macro define-macro="sticky_t">
<td style="width: 50%;vertical-align: top;border: 1px solid grey;padding: 5px;"
 tal:define="templateName python:cl_template[1].name;
             templateId python:cl_template[0]">
 <h3 tal:content="templateName" />

 <tal:rep repeat="slot python:cl_template[1].slotnames">
 <tal:def define="sticky python:service.getStickyContentForLayoutSlot_split(cl_template[0],slot);
                   hasSticky python:sticky[0] != [] or sticky[1] != []">
 <h4 tal:content="slot" />
   <h5>local
    <a class="button" style="padding-left: 5em;"
       tal:attributes="title string:add local sticky content to ${slot};
                       href string:${action_prefix}_add?slot=$slot&layout=${templateId}&layout-title=${templateName}"
       tal:content="string:add to `$slot`..."
       i18n:attributes="title" />
   </h5>

   <tal:rep repeat="index python:range(0,len(sticky[1]))">
    <div tal:define="s python:sticky[1][index];
                     config python:s.getConfig(copy=True);
                     asset python:service.restrictedTraverse(config['object_path'], None)">
     <a tal:attributes="href string:${action_prefix}_remove?layout=${templateId}&partkey=${s/getKey}" onclick="if (confirm('confirm removal of sticky content.  this action cannot be undone.')) return true;return false;">remove</a>
     <a tal:define="pla python:service.getPlacementForStickyContent(s)"
        tal:attributes="href string:${action_prefix}_change_placement?layout=${templateId}&partkey=${s/getKey}&current=${pla}"
        tal:content="pla" />
     <a tal:omit-tag="not:asset"
        tal:attributes="href python:asset and '%s/edit'%asset.absolute_url()"
        tal:content="python:asset and '%s (%s)'%(asset.get_title(), asset.id) or s.getKey()" />
     <span tal:condition="not:asset">sticky content is broken.  unable to find page asset: <span tal:replace="config/object_path" /></span>
     <!-- controls for moving up and down -->
     <tal:def define="next python:index+1 < len(sticky[1]) and sticky[1][index+1] or None;
                      prev python:index > 0 and sticky[1][index-1] or None;">
     <a  tal:condition="prev"
        title="move up"
        tal:attributes="href string:${action_prefix}_move?layout=${templateId}&partkey=${s/getKey}&beforepartkey=${prev/getKey}"
        i18n:attributes="title"
     ><img alt="move up"
             height="12"
              width="16"
              tal:attributes="src string:${root_url}/globals/up.gif"
              i18n:attributes="alt"
      /></a><a tal:condition="next"
               title="move down"
               tal:attributes="href string:${action_prefix}_move?layout=${templateId}&partkey=${next/getKey}&beforepartkey=${s/getKey}"
               i18n:attributes="title"
      ><img alt="move down"
 	   height="12"
 	   width="16"
 	   tal:attributes="src string:${root_url}/globals/down.gif"
 	   i18n:attributes="alt"
      /></a>
     </tal:def>
    </div>
   </tal:rep>

   <h5 tal:condition="python:sticky[0]">acquired</h5>
   <tal:rep repeat="s python:sticky[0]">
     <div tal:define="config python:s.getConfig(copy=True);
                      asset python:service.restrictedTraverse(config['object_path'], None)">
       <a tal:attributes="href string:${action_prefix}_block?layout=${templateId}&partkey=${s/getKey}">block</a>
     <a tal:omit-tag="not:asset"
        tal:attributes="href python:asset and '%s/edit'%asset.absolute_url()"
        tal:content="python:asset and '%s (%s)'%(asset.get_title(), asset.id) or s.getKey()" />
       <span tal:condition="not:asset">sticky content is broken.  unable to find page asset: <span tal:replace="config/object_path" /></span>
     </div>
   </tal:rep>
  </tal:def>
 </tal:rep>

 <tal:def define="blocked python:service.getBlockedPartsForLayout(cl_template[0])"
   tal:condition="blocked">
  <h4>blocked content</h4>
  <tal:block condition="blocked">
   <div tal:repeat="b blocked">
    <tal:def define="s python:service.getStickyContent(cl_template[0], b);
                     config python:s and s.getConfig(copy=True);
                     asset python:config and service.restrictedTraverse(config['object_path'], None)">
     <a tal:attributes="href string:${action_prefix}_unblock?layout=${templateId}&partkey=${b}">unblock</a>
     <a tal:omit-tag="not:asset"
        tal:attributes="href python:asset and '%s/edit'%asset.absolute_url()"
        tal:content="python:asset and '%s (%s)'%(asset.get_title(), asset.id) or b" />
    </tal:def>
   </div>
  </tal:block>
  <tal:block condition="not:blocked">
   none
  </tal:block>
 </tal:def>


</td>
</metal:macro>