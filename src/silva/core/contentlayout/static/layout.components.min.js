(function(e,t,n){var r=function(e){var t,n;while(e.length&&e[0].ownerDocument!==null){t=e.css("position");if(t==="absolute"||t==="relative"||t==="fixed"){n=parseInt(e.css("zIndex"),10);if(!isNaN(n)&&n!==0)return n}e=e.parent()}return 0},i=function(e){var t=e,n=null,i={zIndex:0,placeholder:{active:function(){return!1},clear:function(){},revert:function(){}},placehold:function(n,r,s,o){return this.placeholder.active()||(this.placeholder={$container:t.parent(),$item:t.prev(),direction:"after",$placeholder:n,width:s||this.width,height:r||this.height,active:function(){return this.$placeholder!==null},resize:function(e){this.$placeholder!==null&&(e===!1?(this.$placeholder.height(this.height),this.$placeholder.width("100%")):(this.$placeholder.width(this.width),this.$placeholder.height(this.height)))},revert:function(){this.$placeholder!==null&&(this.$placeholder.remove(),this.$placeholder=null,t=e,i.deplace(this))},clear:function(){this.$placeholder!==null&&(t.before(e),t.remove(),this.$placeholder.remove(),this.$placeholder=null,t=e)}},t=n,o===undefined&&(e.before(n),e.detach(),this.placeholder.resize(undefined)),n.show()),this.placeholder},deplace:function(e,n){e.$item.length?e.$item[e.direction](t):e.$container.prepend(t),this.placeholder.active()&&this.placeholder.resize(n)},destroy:function(){n!==null&&(t.remove(),n=null),e.remove()},over:function(e){var t=e.pageX,n=e.pageY;return n<this.top||t<this.left||n>this.bottom||t>this.right?null:this},update:function(){var e=t.offset();this.top=e.top,this.left=e.left,this.height=t.outerHeight(),this.width=t.outerWidth(),this.bottom=this.top+this.height,this.right=this.left+this.width,this.zIndex=i.zIndex=r(t)}};return i},s=function(t){var n={},r;return t===undefined&&(t=e('<div class="contentlayout-edit-block" />')),r=i(t),e.extend(n,r,{id:t.data("block-id"),editable:t.data("block-editable")===!0,$block:t,set:function(e){this.id=e.block_id,this.editable=e.block_editable,this.$block.attr("data-block-id",e.block_id),this.$block.html(e.block_data),e.block_editable?this.$block.attr("data-block-editable","true"):this.$block.removeAttr("data-block-editable")}}),n},o=function(t,n){var r={},o=[],u,a=0,f=!0;return t!==undefined?n!==undefined&&e(n,t).each(function(){o.push(s(e(this)))}):(t=e('<div class="contentlayout-edit-slot"></div>'),f=!1,a=99),!o.length&&f&&t.addClass("contentlayout-empty-slot"),u=i(t),e.extend(r,u,{id:t.data("slot-id"),$slot:t,zIndex:a,editable:f,horizontal:!1,update:function(){for(var t=0;t<o.length;t++)o[t].update();u.update(),r.horizontal=!1,e.each(o,function(){if(!this.placeholder.active())return r.horizontal=/left|right/.test(this.$block.css("float"))||/inline|table-cell/.test(this.$block.css("display")),!1})},over:function(e){var t=u.over(e),n=null;if(t!==null){for(var r=0;r<o.length;r++){n=o[r].over(e);if(n!==null)return n}return this}return null},set:function(e){this.id=e.slot_id,this.$slot.attr("data-slot-id",e.slot_id)},get:function(e){return o[e]},index:function(t){return e.inArray(t,o)},size:function(){return o.length},add:function(e,n){o.length||t.removeClass("contentlayout-empty-slot"),n!==undefined?o.splice(n,0,e):o.push(e)},remove:function(e){var n=r.index(e),i=null;return n>-1&&(i=o.splice(n,1)[0]),!o.length&&this.editable&&t.addClass("contentlayout-empty-slot"),i}}),r.update(),r};e.extend(t.smi.layout,{components:{Element:i,Block:s,Slot:o}})})(jQuery,infrae,jsontemplate);